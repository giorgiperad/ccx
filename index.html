<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>კრიპტო კოლექტივი X</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1A1A2E 0%, #2E2E4D 100%);
            color: #E0E0E0;
            line-height: 1.5;
            overflow-x: hidden;
            font-size: 16px;
        }
        header {
            background: rgba(30, 30, 60, 0.95);
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #FFFFFF;
        }
        .highlight-x {
            color: #7B68EE;
            font-size: 1.8rem;
            font-weight: 700;
        }
        .container {
            margin: 1rem;
            padding: 1rem;
            background: rgba(40, 40, 70, 0.9);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        h2 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #FFFFFF;
            margin-bottom: 1rem;
            text-align: center;
        }
        .gauge-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .gauge-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 45%;
            padding: 0.75rem;
            background: rgba(30, 30, 50, 0.8);
            border-radius: 10px;
            transition: transform 0.2s ease;
        }
        .gauge-column:hover { transform: scale(1.03); }
        .gauge-circle, .dominance-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            position: relative;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
        }
        .gauge-bg {
            width: 85%;
            height: 85%;
            background: #2E2E4D;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .gauge-value, .dominance-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #FFFFFF;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .top-gainer-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #7B68EE;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
        }
        .top-gainer-circle img { width: 100%; height: 100%; object-fit: cover; }
        .gauge-label, .fear-greed-classification, .dominance-label {
            font-size: 0.9rem;
            color: #B0BEC5;
            margin-top: 0.5rem;
            text-align: center;
        }
        .fear-greed-classification {
            background: rgba(70, 60, 110, 0.7);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
        }
        #price-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 30, 50, 0.8);
            border-radius: 10px;
            overflow: hidden;
        }
        #price-table thead {
            background: rgba(50, 50, 90, 0.9);
            color: #FFFFFF;
            font-weight: 600;
        }
        #price-table th {
            padding: 0.75rem;
            text-align: left;
            font-size: 0.95rem;
        }
        #price-table td {
            padding: 0.75rem;
            font-size: 0.9rem;
            color: #CFD8DC;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        #price-table tr:hover { background: rgba(70, 60, 110, 0.5); }
        #price-table .coin-icon { width: 24px; height: 24px; border-radius: 50%; vertical-align: middle; margin-right: 8px; }
        #price-table .price.green { color: #7B68EE; font-weight: 600; }
        #price-table .price.red { color: #FF5252; font-weight: 600; }

        @media (max-width: 480px) {
            header h1 { font-size: 1.3rem; }
            .highlight-x { font-size: 1.5rem; }
            .gauge-circle, .top-gainer-circle, .dominance-circle { width: 70px; height: 70px; }
            .gauge-value, .dominance-value { font-size: 1.3rem; }
            .gauge-label, .fear-greed-classification, .dominance-label { font-size: 0.85rem; }
            #price-table th, #price-table td { font-size: 0.85rem; padding: 0.6rem; }
            .gauge-column { width: 100%; margin-bottom: 0.5rem; }
        }
    </style>
</head>
<body>
    <header>
        <h1>CRYPTO COLLECTIVE <span class="highlight-x">X</span></h1>
    </header>
    
    <div class="container fear-greed-container">
        <h2 id="quote-display">"საუკეთესო დრო ინვესტიციის დასაწყებად გუშინ იყო, მეორე საუკეთესო დრო კი დღესაა."</h2>
        <div class="gauge-row">
            <div class="gauge-column">
                <div class="gauge-circle" id="fear-greed-circle">
                    <div class="gauge-bg"></div>
                    <span id="fear-greed-value" class="gauge-value">ჩატვირთვა...</span>
                </div>
                <span id="fear-greed-classification" class="fear-greed-classification">ჩატვირთვა...</span>
            </div>
            <div class="gauge-column">
                <div class="top-gainer-circle" id="top-gainer-circle">
                    <img id="top-gainer-logo" src="" alt="Top Gainer Logo">
                </div>
                <span id="top-gainer-label" class="gauge-label">ჩატვირთვა...</span>
            </div>
        </div>
    </div>

    <div class="container dominance-container">
        <h2>ბიტკოინის დომინაცია</h2>
        <div class="gauge-row">
            <div class="gauge-column">
                <div class="dominance-circle" id="dominance-circle">
                    <div class="gauge-bg"></div>
                    <span id="dominance-value" class="dominance-value">ჩატვირთვა...</span>
                </div>
                <span id="dominance-label" class="dominance-label"></span>
            </div>
        </div>
    </div>

    <div class="container prices-container">
        <h2>კრიპტო კოლექტივის პროექტები</h2>
        <table id="price-table">
            <thead>
                <tr>
                    <th data-sort="name">კოინი</th>
                    <th data-sort="price">ფასი</th>
                    <th data-sort="change">24ს ცვლილება</th>
                </tr>
            </thead>
            <tbody id="price-table-body"></tbody>
        </table>
    </div>

    <script>
        const quotesPool = [
            "პრაქტიკა არის გამოცდილება, რომელსაც მივყავართ სრულყოფილებამდე.",
            "საუკეთესო დრო ინვესტიციის დასაწყებად გუშინ იყო, მეორე საუკეთესო დრო კი დღესაა.",
            "რისკი იმაში მდგომარეობს, რაც არ იცი. იცოდე მეტი, გარისკე ნაკლები.",
            "ყოველი დიდი მოგება პატარა ნაბიჯით იწყება.",
            "ფული არ ქმნის იდეებს, იდეები ქმნიან ფულს.",
            "მოითმინე დღეს, რომ ხვალ მოიმკა.",
            "დარგე თესლი დღეს, რომ ხვალ ხე გაიზარდოს.",
            "წარმატება მოდის მათთან, ვინც მოქმედებას იწყებს.",
            "ფული მუშაობს, როცა შენ მას მართავ.",
            "ნუ გეშინია ნელი წინსვლის, გეშინოდეს უმოქმედობის.",
            "ყოველი წარუმატებლობა ახალი დასაწყისია.",
            "ინვესტიცია საკუთარ გონებაში ყოველთვის ანაზღაურდება.",
            "გონივრული რისკი დღეს, დიდი მოგება ხვალ.",
            "არ ეძებო უსაფრთხოება, ეძებე შესაძლებლობა.",
            "ყველაზე დიდი რისკი არის არაფრის გარისკვა。",
            "გააკეთე ის, რაც გჯერა, და ფული მოგყვება.",
            "წარმატება დროისა და შრომის შედეგია。",
            "ნუ ელოდები შანსს, შექმენი ის。",
            "ფინანსური თავისუფლება გადაწყვეტილებებით იწყება。",
            "შეცდომები გზაა სიბრძნისკენ。",
            "ინვესტირება მომავალში ნიშნავს რწმენას საკუთარ თავში。",
            "დღევანდელი მცირე ნაბიჯი ხვალ დიდ გამარჯვებად იქცევა。",
            "არავინ გახდა მდიდარი დაზოგვით, არამედ ინვესტირებით。",
            "გონება, რომელიც ფიქრობს, ყოველთვის პოულობს გზას。",
            "წარმატება მოთმინების ჯილდოა。",
            "რაც არ გცოდნია, ის გაკონტროლებს。",
            "შექმენი შენი მომავალი, სანამ სხვა გააკეთებს ამას。",
            "თუ არ გარისკავ, ვერ გაიზრდები。",
            "ყოველი დღე ახალი შანსია ზრდისთვის。",
            "ფულის ღირებულება მის გამოყენებაშია。",
            "დიდი ოცნებები დიდი ნაბიჯებით იწყება。",
            "წარსული გაკვეთილია, მომავალი — შენი ხელშია。",
            "ინვესტირება არის ნდობა საკუთარი ხედვის მიმართ。",
            "არ გაჩერდე, როცა დაიღალე, გაჩერდი, როცა მიაღწევ。",
            "ფული მოდის მათთან, ვინც მას ეძებს。",
            "ყოველი გადაწყვეტილება შენი მომავლის ნაწილია。",
            "გარისკე, რომ გაიზარდო, მაგრამ გაიზარდე, რომ გაიმარჯვო。",
            "წარმატება არის შრომისა და რწმენის ნაზავი。",
            "დღეს გაკეთებული საქმე ხვალ შენს მადლიერებას დაიმსახურებს。",
            "არ ეძებო სრულყოფილ მომენტს, გახადე მომენტი სრულყოფილი。",
            "ფინანსური დამოუკიდებლობა არჩევანია, არა შემთხვევა。",
            "თუ გჯერა, ყველაფერი შესაძლებელია。",
            "დიდი შედეგები მცირე თანმიმდევრულობით იბადება。",
            "ფული არის იარაღი, გამოიყენე გონივრულად。",
            "შეცვალე აზროვნება, შეიცვლება შენი სამყაროც。",
            "მომავალი მათ ეკუთვნით, ვინც დღეს მუშაობს。",
            "არ შეგეშინდეს დაცემის, შეგეშინდეს ადგომის შეწყვეტის。",
            "ინვესტიცია დროში ისევე მნიშვნელოვანია, როგორც ფულში。",
            "გააკეთე ის, რაც გაშინებს, და შიში გაქრება。",
            "წარმატება არის გზა, რომელსაც თავად აგებ.",
            "ფული მაშინ მოდის, როცა შენ მზად ხარ მის მისაღებად。",
            "ყოველი ნაბიჯი მიგიყვანს იქ, სადაც გინდა იყო。",
            "დაიწყე იქ, სადაც ხარ, გამოიყენე ის, რაც გაქვს。",
            "იყიდე მხოლოდ ის, რისი დაკარგვაც სიამოვნებით შეგიძლია 10 წლით. — უორენ ბაფეტი",
            "იცოდე, რას ფლობ, და იცოდე, რატომ ფლობ ამას. — პიტერ ლინჩი",
            "შეცდომების აღიარება წარმატების გასაღებია. — რეი დალიო",
            "დიდი ფული არა გონებაშია, არამედ მოთმინებაში. — ჩარლი მანგერი",
            "ბაზარი მოკლევადიან პერსპექტივაში ხმის მიმცემი მანქანაა, გრძელვადიანში — სასწორი. — ბენჯამინ გრეჰემი",
            "დრო შენი მეგობარია, იმპულსი — მტერი. — ჯონ ბოგლი",
            "ბაზარი სავსეა ხმაურით, მაგრამ წარმატება მშვიდ ფიქრშია. — ფილიპ ფიშერი",
            "მთავარია არა ფულის გამომუშავება, არამედ მისი შენარჩუნება. — ჯესი ლივერმორი",
            "ინვესტირება არის რისკის მართვა, და არა მისი თავიდან აცილება. — ჯიმ რიკარდსი",
            "რაც უფრო ნაკლებია შენი მოლოდინი, მით უკეთესია შედეგი. — ჰოვარდ მარკსი",
            "ნუ იყიდი იმიტომ, რომ იაფია, იყიდე, რადგან ღირებულია. — კარლ აიკანი",
            "ყველაზე დიდი შესაძლებლობები მაქსიმალური პესიმიზმის დროს ჩნდება. — ჯონ ტემპლტონი",
            "იყავი შეშინებული, როცა სხვები თავდაჯერებულნი არიან, და თავდაჯერებული, როცა სხვები შეშინებულნი არიან. — უორენ ბაფეტი",
            "ნუ ფოკუსირდები მოგებაზე, ფოკუსირდი კაპიტალის დაცვაზე. — პოლ ტიუდორ ჯონსი",
            "მდიდრები ყიდულობენ აქტივებს, ღარიბები — ვალდებულებებს. — რობერტ კიოსაკი",
            "მონაცემები მეტყველებს, თუ მოუსმენ. — ჯეიმს საიმონსი",
            "ყველაზე დიდი მოგება მოდის იქ, სადაც სხვები ვერ ხედავენ. — ჯონ პოლსონი",
            "რეპუტაციის აშენებას 20 წელი სჭირდება, მის განადგურებას კი 5 წუთი. — უორენ ბაფეტი",
            "ყოველთვის იცხოვრე ისე, რომ შენი შემოსავალი აღემატებოდეს ხარჯებს. — უორენ ბაფეტი",
            "ფასი ისაა, რასაც იხდი, ღირებულება — რასაც იღებ. — უორენ ბაფეტი",
            "საუკეთესო ინვესტიცია ისაა, რაც შენს გონებაში ხდება. — უორენ ბაფეტი",
            "ბაზარზე გრძელი თამაში მოითხოვს მოთმინებას, და არა ემოციებს. — უორენ ბაფეტი"
        ];

        const fallbackData = {
            fearGreed: { value: 50, classification: "Neutral" },
            dominance: { value: 62.5 }, // Typical recent BTC.D value as of early 2025
            coins: [
                { name: "Bitcoin", symbol: "btc", current_price: 60000, price_change_percentage_24h: 2.5, image: "https://assets.coingecko.com/coins/images/1/small/bitcoin.png" },
                { name: "Ethereum", symbol: "eth", current_price: 2000, price_change_percentage_24h: -1.2, image: "https://assets.coingecko.com/coins/images/279/small/ethereum.png" }
            ]
        };

        function getCachedData(key) {
            const cached = localStorage.getItem(key);
            return cached ? JSON.parse(cached) : null;
        }

        function setCachedData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function getRandomQuote(exclude) {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * quotesPool.length);
            } while (quotesPool[newIndex] === exclude && quotesPool.length > 1);
            return quotesPool[newIndex];
        }

        function displayRandomQuote() {
            const lastQuote = getCachedData('lastQuote') || quotesPool[0];
            const newQuote = getRandomQuote(lastQuote);
            document.getElementById('quote-display').textContent = `"${newQuote}"`;
            setCachedData('lastQuote', newQuote);
        }

        async function fetchWithRetry(url, retries = 2, delay = 500) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    if (i === retries - 1) return null;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        let coinData = [];
        const sortDirection = {};

        function renderTable(data) {
            const priceTableBody = document.getElementById('price-table-body');
            priceTableBody.innerHTML = '';
            data.forEach(coin => {
                const price = coin.current_price.toFixed(coin.symbol === 'btc' ? 2 : 6);
                const change24h = coin.price_change_percentage_24h || 0;
                const priceColorClass = change24h >= 0 ? 'green' : 'red';
                const row = document.createElement('tr');
                row.dataset.coin = coin.symbol;
                row.innerHTML = `
                    <td><img src="${coin.image}" alt="${coin.name} icon" class="coin-icon">${coin.name} (${coin.symbol.toUpperCase()})</td>
                    <td class="price ${priceColorClass}">$${price}</td>
                    <td class="price ${priceColorClass}">${change24h.toFixed(2)}%</td>
                `;
                priceTableBody.appendChild(row);
            });
        }

        function sortTable(field) {
            if (!coinData.length) return;

            const direction = sortDirection[field] === 'asc' ? 'desc' : 'asc';
            sortDirection[field] = direction;
            const multiplier = direction === 'asc' ? 1 : -1;

            coinData.sort((a, b) => {
                if (field === 'name') return multiplier * (a.name || '').localeCompare(b.name || '');
                if (field === 'price') return multiplier * ((a.current_price || 0) - (b.current_price || 0));
                if (field === 'change') return multiplier * ((a.price_change_percentage_24h || 0) - (b.price_change_percentage_24h || 0));
                return 0;
            });

            document.querySelectorAll('#price-table th').forEach(th => {
                th.classList.remove('asc', 'desc');
                if (th.getAttribute('data-sort') === field) th.classList.add(direction);
            });

            renderTable(coinData);
        }

        async function fetchData() {
            try {
                const cachedCoins = getCachedData('coinData');
                if (cachedCoins) {
                    coinData = cachedCoins;
                    renderTable(coinData);
                    const topGainer = coinData.reduce((max, coin) => 
                        (coin.price_change_percentage_24h || 0) > (max.price_change_percentage_24h || 0) ? coin : max, coinData[0]);
                    document.getElementById('top-gainer-logo').src = topGainer.image;
                    document.getElementById('top-gainer-label').textContent = `${topGainer.name} (${topGainer.price_change_percentage_24h.toFixed(2)}%)`;
                }

                const [fngData, priceData] = await Promise.all([
                    fetchWithRetry('https://api.alternative.me/fng/?limit=1'),
                    fetchWithRetry(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=bitcoin,rejuve-ai,sophiaverse,chia,stellar,kava,decentraland,zksync,arbitrum,optimism,dforce-token,band-protocol,notcoin,polkadot,solana,singularity-finance,flare-networks,redbelly-network-token,songbird,vestate,coin98,hypercycle,alien-worlds,chainge-finance,befi-labs,hello-labs,masa-finance,cardano,ripple,celo,osmosis,cosmos,berachain-bera,sui,beoble,dia-data,chainlink,agridex-governance-token,kolz,kitten-haimer,badger-dao,iota,worldcoin-wld,mintlayer,ethereum&order=market_cap_desc&per_page=50&page=1&sparkline=false`)
                ]);

                // Fear and Greed
                const fng = fngData?.data?.[0] || fallbackData.fearGreed;
                document.getElementById('fear-greed-value').textContent = fng.value;
                const todayAngle = (fng.value / 100) * 360;
                const fearGreedCircle = document.getElementById('fear-greed-circle');
                let sentimentColor = fng.value < 50 ? '#FF5252' : '#7B68EE';
                fearGreedCircle.style.background = `conic-gradient(${sentimentColor} 0deg, #2E2E4D ${todayAngle}deg, #1A1A2E ${todayAngle}deg, #1A1A2E 360deg)`;
                fearGreedCircle.style.borderColor = sentimentColor;
                const translations = { "Extreme Fear": "უკიდურესი შიში", "Fear": "შიში", "Neutral": "ნეიტრალური", "Greed": "სიხარბე", "Extreme Greed": "უკიდურესი სიხარბე" };
                document.getElementById('fear-greed-classification').textContent = translations[fng.value_classification] || fng.value_classification;

                // Bitcoin Dominance (BTC.D from TradingView concept, static fallback)
                const dominance = getCachedData('dominance') || fallbackData.dominance.value; // Replace with TradingView widget or manual update in practice
                document.getElementById('dominance-value').textContent = `${dominance}%`;
                const dominanceAngle = (dominance / 100) * 360;
                const dominanceCircle = document.getElementById('dominance-circle');
                dominanceCircle.style.background = `conic-gradient(#7B68EE 0deg, #2E2E4D ${dominanceAngle}deg, #1A1A2E ${dominanceAngle}deg, #1A1A2E 360deg)`;
                dominanceCircle.style.borderColor = '#7B68EE';
                setCachedData('dominance', dominance); // Cache for next load

                // Coin Prices
                coinData = priceData?.length > 0 ? priceData : (cachedCoins || fallbackData.coins);
                setCachedData('coinData', coinData);
                const topGainer = coinData.reduce((max, coin) => 
                    (coin.price_change_percentage_24h || 0) > (max.price_change_percentage_24h || 0) ? coin : max, coinData[0]);
                document.getElementById('top-gainer-logo').src = topGainer.image;
                document.getElementById('top-gainer-label').textContent = `${topGainer.name} (${topGainer.price_change_percentage_24h.toFixed(2)}%)`;

                renderTable(coinData);

            } catch (error) {
                console.error('Critical error in fetchData:', error.message);
                document.getElementById('fear-greed-value').textContent = fallbackData.fearGreed.value;
                document.getElementById('fear-greed-circle').style.background = 'conic-gradient(#7B68EE 0deg, #2E2E4D 180deg, #1A1A2E 180deg, #1A1A2E 360deg)';
                document.getElementById('fear-greed-classification').textContent = "ნეიტრალური";

                document.getElementById('dominance-value').textContent = `${fallbackData.dominance.value}%`;
                document.getElementById('dominance-circle').style.background = 'conic-gradient(#7B68EE 0deg, #2E2E4D 225deg, #1A1A2E 225deg, #1A1A2E 360deg)';

                coinData = getCachedData('coinData') || fallbackData.coins;
                renderTable(coinData);
                const topGainer = coinData.reduce((max, coin) => 
                    (coin.price_change_percentage_24h || 0) > (max.price_change_percentage_24h || 0) ? coin : max, coinData[0]);
                document.getElementById('top-gainer-logo').src = topGainer.image;
                document.getElementById('top-gainer-label').textContent = `${topGainer.name} (${topGainer.price_change_percentage_24h.toFixed(2)}%)`;
            }
        }

        displayRandomQuote();
        fetchData();
        setInterval(fetchData, 300000);

        document.querySelectorAll('#price-table th').forEach(th => {
            th.addEventListener('click', () => {
                const field = th.getAttribute('data-sort');
                if (field) sortTable(field);
            });
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                displayRandomQuote();
            }
        });
    </script>
</body>
</html>
