<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>კრიპტო კოლექტივი X</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Roboto', sans-serif; 
            background: #121A23; /* CoinMarketCap primary background */
            color: #FFFFFF; /* White text for contrast */
            line-height: 1.6; 
            overflow-x: hidden; 
        }
        header { 
            background: #1C2526; /* CoinMarketCap secondary background */
            padding: clamp(1.5rem, 2.5vw, 2.5rem); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); 
            position: sticky; 
            top: 0; 
            z-index: 10; 
            border-bottom: 3px solid #333333; /* Dark gray border */
            transition: all 0.3s ease; 
        }
        header:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.7); }
        header h1 { 
            font-family: 'Montserrat', sans-serif; 
            font-size: clamp(2rem, 4.5vw, 3rem); 
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: clamp(1.5px, 0.3vw, 2.5px); 
            color: #FFFFFF; 
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5); 
        }
        .highlight-x { 
            color: #00FF00; /* CMC green for emphasis */
            font-size: clamp(2.8rem, 5.5vw, 3.8rem); 
            transition: all 0.3s ease; 
        }
        header:hover .highlight-x { transform: scale(1.05); color: #FFFFFF; }

        .fear-greed-container, .prices-container { 
            padding: clamp(20px, 3vw, 40px); 
            margin: clamp(20px, 2.5vw, 40px) auto; 
            max-width: 85%; 
            background: #1C2526; /* CoinMarketCap secondary background */
            border-radius: 15px; 
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5); 
            text-align: center; 
            transition: all 0.3s ease; 
            border: 1px solid #333333; /* Dark gray border */
        }
        .fear-greed-container:hover, .prices-container:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 35px rgba(51, 51, 51, 0.3); 
        }
        .fear-greed-container h2, .prices-container h2 { 
            font-family: 'Montserrat', sans-serif; 
            font-size: clamp(1.5rem, 2.5vw, 1.8rem); 
            margin-bottom: clamp(15px, 2vw, 20px); 
            color: #FFFFFF; 
            text-transform: uppercase; 
            letter-spacing: clamp(1px, 0.2vw, 1.5px); 
            background: #333333; /* Dark gray */
            padding: clamp(6px, 1vw, 10px); 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4); 
        }
        .gauge-row { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: clamp(15px, 2vw, 30px); 
            flex-wrap: wrap; 
            margin-bottom: clamp(20px, 1.5vw, 25px); 
        }
        .gauge-column { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            width: clamp(130px, 20vw, 160px); 
            background: #121A23; /* CoinMarketCap primary background */
            padding: clamp(12px, 1.5vw, 15px); 
            border-radius: 12px; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4); 
            transition: all 0.3s ease; 
            border: 1px solid #333333; /* Dark gray */
        }
        .gauge-column:hover { 
            transform: scale(1.05); 
            box-shadow: 0 7px 20px rgba(51, 51, 51, 0.4); 
        }
        .gauge-circle { 
            width: clamp(90px, 13vw, 120px); 
            height: clamp(90px, 13vw, 120px); 
            border-radius: 50%; 
            background: #121A23; /* CoinMarketCap primary background */
            position: relative; 
            clip-path: circle(50%); 
            transition: all 0.5s ease; 
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.4); 
        }
        .gauge-bg { 
            width: 90%; 
            height: 90%; 
            background: #1C2526; /* CoinMarketCap secondary background */
            border-radius: 50%; 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.5); 
        }
        .gauge-value { 
            font-size: clamp(1.4rem, 2.5vw, 1.8rem); 
            font-weight: 700; 
            color: #FFFFFF; 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); 
        }
        .top-gainer-circle { 
            width: clamp(90px, 13vw, 120px); 
            height: clamp(90px, 13vw, 120px); 
            border-radius: 50%; 
            background: #121A23; /* CoinMarketCap primary background */
            position: relative; 
            overflow: hidden; 
            border: 3px solid #333333; /* Dark gray */
            box-shadow: 0 3px 12px rgba(51, 51, 51, 0.3); 
        }
        .top-gainer-circle img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
        .gauge-label { 
            font-size: clamp(0.8rem, 1.2vw, 1rem); 
            color: #B0B0B0; /* Light gray */
            margin-top: clamp(8px, 1vw, 12px); 
            text-align: center; 
        }
        .fear-greed-classification { 
            font-size: clamp(0.8rem, 1.2vw, 1rem); 
            color: #FFFFFF; 
            margin-top: clamp(8px, 1vw, 12px); 
            background: #333333; /* Dark gray */
            padding: clamp(5px, 0.8vw, 8px) clamp(10px, 1.2vw, 15px); 
            border-radius: 20px; 
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4); 
        }
        #price-table { 
            width: 100%; 
            border-collapse: collapse; 
            background: #121A23; /* CoinMarketCap primary background */
            border-radius: 12px; 
            overflow: hidden; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); 
        }
        #price-table thead { 
            background: #1C2526; /* CoinMarketCap secondary background */
            color: #FFFFFF; 
            text-transform: uppercase; 
            font-family: 'Montserrat', sans-serif; 
            font-size: clamp(0.9rem, 1.2vw, 1.1rem); 
        }
        #price-table th { 
            padding: clamp(12px, 1.5vw, 15px); 
            text-align: left; 
            border-bottom: 2px solid #333333; /* Dark gray */
            font-weight: 700; 
            cursor: pointer; 
            position: relative; 
            transition: background 0.3s ease; 
        }
        #price-table th:hover { background: #2A3435; /* Slightly lighter gray */
        }
        #price-table th::after { content: '↕'; margin-left: 5px; font-size: 0.8em; opacity: 0.5; }
        #price-table th.asc::after { content: '↑'; opacity: 1; }
        #price-table th.desc::after { content: '↓'; opacity: 1; }
        #price-table td { 
            padding: clamp(12px, 1.5vw, 15px); 
            text-align: left; 
            border-bottom: 1px solid #333333; /* Dark gray */
            font-size: clamp(0.85rem, 1.1vw, 1rem); 
            color: #B0B0B0; 
        }
        #price-table tr:nth-child(even) { background: #1C2526; /* CoinMarketCap secondary background */ }
        #price-table tr:hover { background: #333333; /* Dark gray */ transition: background 0.3s ease; }
        #price-table .coin-icon { width: 32px; height: 32px; border-radius: 50%; vertical-align: middle; margin-right: 10px; }
        #price-table .price.green { color: #00FF00; /* CMC green */ font-weight: 700; }
        #price-table .price.red { color: #FF0000; /* CMC red */ font-weight: 700; }

        @media (max-width: 768px) {
            header { padding: clamp(1rem, 1.5vw, 1.5rem); }
            .fear-greed-container, .prices-container { padding: 20px; margin: 20px auto; max-width: 90%; }
            .gauge-circle, .top-gainer-circle { width: clamp(70px, 11vw, 100px); height: clamp(70px, 11vw, 100px); }
            .gauge-value { font-size: clamp(1.2rem, 2.2vw, 1.6rem); }
            .gauge-label, .fear-greed-classification { font-size: clamp(0.75rem, 1vw, 0.9rem); }
            .gauge-column { width: clamp(110px, 18vw, 140px); }
            #price-table th, #price-table td { padding: clamp(8px, 1vw, 12px); font-size: clamp(0.8rem, 1vw, 0.95rem); }
            .gauge-row { gap: clamp(10px, 1.5vw, 15px); }
        }
        @media (max-width: 480px) {
            header h1 { font-size: clamp(1.5rem, 3vw, 1.8rem); }
            .highlight-x { font-size: clamp(1.8rem, 3.5vw, 2.2rem); }
            .fear-greed-container h2, .prices-container h2 { font-size: clamp(1.3rem, 2vw, 1.6rem); }
            .gauge-circle, .top-gainer-circle { width: clamp(60px, 9vw, 80px); height: clamp(60px, 9vw, 80px); }
            .gauge-value { font-size: clamp(1rem, 1.8vw, 1.4rem); }
            .gauge-label, .fear-greed-classification { font-size: clamp(0.65rem, 0.9vw, 0.8rem); }
            #price-table th, #price-table td { padding: clamp(6px, 0.8vw, 10px); font-size: clamp(0.75rem, 0.9vw, 0.9rem); }
            #price-table .coin-icon { width: 24px; height: 24px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>CRYPTO COLLECTIVE <span class="highlight-x">X</span></h1>
    </header>
    
    <div class="fear-greed-container">
        <h2 id="quote-display">"საუკეთესო დრო ინვესტიციის დასაწყებად გუშინ იყო, მეორე საუკეთესო დრო კი დღესაა."</h2>
        <div class="gauge-row">
            <div class="gauge-column">
                <div class="gauge-circle" id="fear-greed-circle">
                    <div class="gauge-bg"></div>
                    <span id="fear-greed-value" class="gauge-value">ჩატვირთვა...</span>
                </div>
                <span id="fear-greed-classification" class="fear-greed-classification">ჩატვირთვა...</span>
            </div>
            <div class="gauge-column">
                <div class="top-gainer-circle" id="top-gainer-circle">
                    <img id="top-gainer-logo" src="" alt="Top Gainer Logo">
                </div>
                <span id="top-gainer-label" class="gauge-label">ჩატვირთვა...</span>
            </div>
        </div>
    </div>

    <div class="prices-container">
        <h2>კრიპტო კოლექტივის პროექტები</h2>
        <table id="price-table">
            <thead>
                <tr>
                    <th data-sort="name">კოინი</th>
                    <th data-sort="price">ფასი</th>
                    <th data-sort="change">24ს ცვლილება</th>
                </tr>
            </thead>
            <tbody id="price-table-body"></tbody>
        </table>
    </div>

    <script>
        const quotesPool = [
            "საუკეთესო დრო ინვესტიციის დასაწყებად გუშინ იყო, მეორე საუკეთესო დრო კი დღესაა.",
            "რისკი იმაში მდგომარეობს, რაც არ იცი. იცოდე მეტი, გარისკე ნაკლები.",
            "ყოველი დიდი მოგება პატარა ნაბიჯით იწყება。",
            "ფული არ ქმნის იდეებს, იდეები ქმნიან ფულს。",
            "მოითმინე დღეს, რომ ხვალ მოიმკა。"
        ];

        const fallbackData = {
            fearGreed: { value: 50, classification: "Neutral" },
            coins: [
                { name: "Bitcoin", symbol: "btc", current_price: 60000, price_change_percentage_24h: 2.5, image: "https://assets.coingecko.com/coins/images/1/small/bitcoin.png" },
                { name: "Ethereum", symbol: "eth", current_price: 2000, price_change_percentage_24h: -1.2, image: "https://assets.coingecko.com/coins/images/279/small/ethereum.png" }
            ]
        };

        function getCachedData(key) {
            const cached = localStorage.getItem(key);
            return cached ? JSON.parse(cached) : null;
        }

        function setCachedData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function getRandomQuote(exclude) {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * quotesPool.length);
            } while (quotesPool[newIndex] === exclude && quotesPool.length > 1);
            return quotesPool[newIndex];
        }

        function displayRandomQuote() {
            const lastQuote = getCachedData('lastQuote') || quotesPool[0];
            const newQuote = getRandomQuote(lastQuote);
            document.getElementById('quote-display').textContent = `"${newQuote}"`;
            setCachedData('lastQuote', newQuote);
        }

        async function fetchWithRetry(url, retries = 2, delay = 500) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    if (i === retries - 1) return null;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        let coinData = [];
        const sortDirection = {};

        function renderTable(data) {
            const priceTableBody = document.getElementById('price-table-body');
            priceTableBody.innerHTML = '';
            data.forEach(coin => {
                const price = coin.current_price.toFixed(coin.symbol === 'btc' ? 2 : 6);
                const change24h = coin.price_change_percentage_24h || 0;
                const priceColorClass = change24h >= 0 ? 'green' : 'red';
                const row = document.createElement('tr');
                row.dataset.coin = coin.symbol;
                row.innerHTML = `
                    <td><img src="${coin.image}" alt="${coin.name} icon" class="coin-icon">${coin.name} (${coin.symbol.toUpperCase()})</td>
                    <td class="price ${priceColorClass}">$${price}</td>
                    <td class="price ${priceColorClass}">${change24h.toFixed(2)}%</td>
                `;
                priceTableBody.appendChild(row);
            });
        }

        function sortTable(field) {
            if (!coinData.length) return;

            const direction = sortDirection[field] === 'asc' ? 'desc' : 'asc';
            sortDirection[field] = direction;
            const multiplier = direction === 'asc' ? 1 : -1;

            coinData.sort((a, b) => {
                if (field === 'name') return multiplier * (a.name || '').localeCompare(b.name || '');
                if (field === 'price') return multiplier * ((a.current_price || 0) - (b.current_price || 0));
                if (field === 'change') return multiplier * ((a.price_change_percentage_24h || 0) - (b.price_change_percentage_24h || 0));
                return 0;
            });

            document.querySelectorAll('#price-table th').forEach(th => {
                th.classList.remove('asc', 'desc');
                if (th.getAttribute('data-sort') === field) {
                    th.classList.add(direction);
                }
            });

            renderTable(coinData);
        }

        async function fetchData() {
            try {
                const cachedCoins = getCachedData('coinData');
                if (cachedCoins) {
                    coinData = cachedCoins;
                    renderTable(coinData);
                    const topGainer = coinData.reduce((max, coin) => 
                        (coin.price_change_percentage_24h || 0) > (max.price_change_percentage_24h || 0) ? coin : max, coinData[0]);
                    document.getElementById('top-gainer-logo').src = topGainer.image;
                    document.getElementById('top-gainer-label').textContent = `${topGainer.name} (${topGainer.price_change_percentage_24h.toFixed(2)}%)`;
                }

                const [fngData, priceData] = await Promise.all([
                    fetchWithRetry('https://api.alternative.me/fng/?limit=1'),
                    fetchWithRetry(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=bitcoin,rejuve-ai,sophiaverse,chia,stellar,kava,decentraland,zksync,arbitrum,optimism,dforce-token,band-protocol,notcoin,polkadot,solana,singularity-finance,flare-networks,redbelly-network-token,songbird,vestate,coin98,hypercycle,alien-worlds,chainge-finance,befi-labs,hello-labs,masa-finance,cardano,ripple,celo,osmosis,cosmos,berachain-bera,sui,beoble,dia-data,chainlink,agridex-governance-token,kolz,kitten-haimer,badger-dao,iota,worldcoin-wld,mintlayer,ethereum&order=market_cap_desc&per_page=50&page=1&sparkline=false`)
                ]);

                const fng = fngData?.data?.[0] || fallbackData.fearGreed;
                document.getElementById('fear-greed-value').textContent = fng.value;
                const todayAngle = (fng.value / 100) * 360;
                const fearGreedCircle = document.getElementById('fear-greed-circle');
                let sentimentColor = fng.value < 50 ? '#FF0000' : '#00FF00';
                fearGreedCircle.style.background = `conic-gradient(${sentimentColor} 0deg, #1C2526 ${todayAngle}deg, #121A23 ${todayAngle}deg, #121A23 360deg)`;
                fearGreedCircle.style.borderColor = sentimentColor;
                const translations = { "Extreme Fear": "უკიდურესი შიში", "Fear": "შიში", "Neutral": "ნეიტრალური", "Greed": "სიხარბე", "Extreme Greed": "უკიდურესი სიხარბე" };
                document.getElementById('fear-greed-classification').textContent = translations[fng.value_classification] || fng.value_classification;

                coinData = priceData?.length > 0 ? priceData : (cachedCoins || fallbackData.coins);
                setCachedData('coinData', coinData);
                const topGainer = coinData.reduce((max, coin) => 
                    (coin.price_change_percentage_24h || 0) > (max.price_change_percentage_24h || 0) ? coin : max, coinData[0]);
                document.getElementById('top-gainer-logo').src = topGainer.image;
                document.getElementById('top-gainer-label').textContent = `${topGainer.name} (${topGainer.price_change_percentage_24h.toFixed(2)}%)`;

                renderTable(coinData);

            } catch (error) {
                console.error('Critical error in fetchData:', error.message);
                document.getElementById('fear-greed-value').textContent = fallbackData.fearGreed.value;
                document.getElementById('fear-greed-circle').style.background = 'conic-gradient(#00FF00 0deg, #1C2526 180deg, #121A23 180deg, #121A23 360deg)';
                document.getElementById('fear-greed-classification').textContent = "ნეიტრალური";

                coinData = getCachedData('coinData') || fallbackData.coins;
                renderTable(coinData);
                const topGainer = coinData.reduce((max, coin) => 
                    (coin.price_change_percentage_24h || 0) > (max.price_change_percentage_24h || 0) ? coin : max, coinData[0]);
                document.getElementById('top-gainer-logo').src = topGainer.image;
                document.getElementById('top-gainer-label').textContent = `${topGainer.name} (${topGainer.price_change_percentage_24h.toFixed(2)}%)`;
            }
        }

        displayRandomQuote();
        fetchData();
        setInterval(fetchData, 300000);

        document.querySelectorAll('#price-table th').forEach(th => {
            th.addEventListener('click', () => {
                const field = th.getAttribute('data-sort');
                if (field) sortTable(field);
            });
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                displayRandomQuote();
            }
        });
    </script>
</body>
</html>
